{% extends 'form/base.html' %}
{% load static %}

{% block title %}Dashboard - Solar Analyzer{% endblock %}

{% block content %}
    <!-- Swiper CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@10/swiper-bundle.min.css" />
    {% comment %} <style>
        .fade-in {
            animation: fadeIn 0.6s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to   { opacity: 1; }
        }

        .stepper {
            display: flex;
            justify-content: space-between;
            margin-bottom: 2rem;
        }

        .step {
            text-align: center;
            flex: 1;
            position: relative;
        }

        .step:not(:last-child)::after {
            content: '';
            position: absolute;
            top: 20px;
            right: -50%;
            width: 100%;
            height: 3px;
            background-color: #dee2e6;
            z-index: 0;
        }

        .step-icon {
            width: 40px;
            height: 40px;
            line-height: 38px;
            border-radius: 50%;
            display: inline-block;
            font-weight: bold;
            z-index: 1;
            position: relative;
        }

        .active-step .step-icon {
            background-color: #0d6efd;
            color: white;
        }

        .inactive-step .step-icon {
            background-color: #e9ecef;
            color: #6c757d;
        }

        .swiper-container {
            width: 100%;
            max-width: 600px;
            margin: 0 auto;
        }
        
        .swiper-slide {
            display: flex;
            justify-content: center;
            align-items: center;
            height: auto;
            padding: 10px;
        }
        
        .card-choice {
            width: 100%;
            max-width: 500px;
            cursor: pointer;
            border: 2px solid transparent;
            transition: border-color 0.3s ease;
        }
        
        .card-choice.selected {
            border-color: #007bff;
            box-shadow: 0 0 8px rgba(0,123,255,0.5);
        }
        
        .swiper-button-prev::after,
        .swiper-button-next::after {
            display: none !important; /* Hide Swiper default icons */
        }

        .custom-swiper-btn {
            width: 40px;
            height: 40px;
            background-color: #e9ecef;
            border-radius: 50%;
            color: #000;
            font-size: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10;
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
        }
        
        .swiper-button-prev.custom-swiper-btn::before {
            content: "‚Üê";
        }
        
        .swiper-button-next.custom-swiper-btn::before {
            content: "‚Üí";
        }
        

    </style> {% endcomment %}
    <style>
        .fade-in {
            animation: fadeIn 0.6s ease-in;
        }
      
        @keyframes fadeIn {
            from { opacity: 0; }
            to   { opacity: 1; }
        }
      
        .stepper {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            gap: 1rem;
            margin-bottom: 2rem;
        }
      
        .step {
            text-align: center;
            flex: 1 1 45%;
            position: relative;
        }
      
        .step:not(:last-child)::after {
            content: '';
            position: absolute;
            top: 20px;
            right: -50%;
            width: 100%;
            height: 3px;
            background-color: #dee2e6;
            z-index: 0;
        }
      
        @media (max-width: 576px) {
            .step {
                flex: 1 1 100%;
            }
      
            .step:not(:last-child)::after {
                top: auto;
                bottom: -20px;
                left: 50%;
                transform: translateX(-50%);
                width: 3px;
                height: 30px;
            }
        }
      
        .step-icon {
            width: 40px;
            height: 40px;
            line-height: 38px;
            border-radius: 50%;
            display: inline-block;
            font-weight: bold;
            z-index: 1;
            position: relative;
        }
      
        .active-step .step-icon {
            background-color: #0d6efd;
            color: white;
        }
      
        .inactive-step .step-icon {
            background-color: #e9ecef;
            color: #6c757d;
        }
      
        .swiper-container {
            width: 100%;
            max-width: 600px;
            margin: 0 auto;
        }
      
        .swiper-slide {
            display: flex;
            justify-content: center;
            align-items: center;
            height: auto;
            padding: 10px;
        }
      
        .card-choice {
            width: 100%;
            cursor: pointer;
            border: 2px solid transparent;
            transition: border-color 0.3s ease;
        }
      
        .card-choice.selected {
            border-color: #007bff;
            box-shadow: 0 0 8px rgba(0,123,255,0.5);
        }
      
        .swiper-button-prev::after,
        .swiper-button-next::after {
            display: none !important;
        }
      
        .custom-swiper-btn {
            width: 36px;
            height: 36px;
            background-color: #f1f1f1;
            border-radius: 50%;
            color: #000;
            font-size: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10;
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
        }
      
        .swiper-button-prev.custom-swiper-btn::before {
            content: "‚Üê";
        }
      
        .swiper-button-next.custom-swiper-btn::before {
            content: "‚Üí";
        }
      
        /* Image should scale nicely on mobile */
        .card-choice img {
            max-height: 150px;
            object-fit: contain;
            width: 100%;
        }
      
        @media (max-width: 768px) {
            .card-choice {
                max-width: 90%;
            }
        }
      </style>
      


  <div class="container-fluid px-3 px-sm-4 px-md-5">

    <!-- Header -->
    <div class="text-center mb-5">
      <h1 class="display-5 fw-bold">‚òÄÔ∏è Choose Your Solar Data</h1>
      <p class="lead">Welcome, <strong>{{ request.user.username }}</strong></p>
    </div>


    <div class="container py-5 fade-in">

        <!-- Stepper -->
        <div class="stepper">
            <div class="step active-step">
                <div class="step-icon">üìç</div>
                <div>Step 1: Region</div>
            </div>
            <div class="step inactive-step">
                <div class="step-icon">‚öôÔ∏è</div>
                <div>Step 2: Package</div>
            </div>
        </div>
    
        <h3 class="text-center mb-4">Step 1: Region & Usage</h3>
    
        <!-- Progress Bar -->
        <div class="progress mb-4" style="height: 25px;">
            <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar"
                 style="width: 50%;" aria-valuenow="50" aria-valuemin="0" aria-valuemax="100">
                Step 1 of 2
            </div>
        </div>
    
        <!-- Card Container -->
        <div class="card">
            <div class="card-body">
    
                <form id="step1Form" method="POST" onsubmit="return validateStep1Form();">
                    {% csrf_token %}
    
                    <!-- Usage Type -->
                    <div class="mb-3">
                        {{ form.usage_type.label_tag }}
                        {{ form.usage_type }}
                    </div>
    
                    <!-- Region -->
                    <div class="mb-3">
                        {{ form.region.label_tag }}
                        {{ form.region }}
                    </div>
    
                    <!-- Hidden Appliance Profile Select -->
                    <div style="display:none;">
                        {{ form.appliance_profile }}
                    </div>
    
                    <!-- Appliance Profile Selection with Swiper -->
                    <label for="applianceProfileCards" class="form-label">Appliance Profile</label>
    
                    <div class="position-relative">
    
                        <!-- Swiper Container -->
                        <div class="swiper mySwiper">
                            <div class="swiper-wrapper">
                                {% for profile in appliance_profiles %}
                                    <div class="swiper-slide">
                                        <div class="card-choice card p-4 text-center h-100" data-id="{{ profile.id }}">
                                            {% if profile.image %}
                                                <img src="{{ profile.image.url }}" alt="{{ profile.name }}" class="img-fluid mb-3" style="max-height: 200px; object-fit: contain;">
                                            {% else %}
                                                <img src="{% static 'default_appliance.png' %}" alt="No image" class="img-fluid mb-3" style="max-height: 200px; object-fit: contain;">
                                            {% endif %}
                                            <h5 class="card-title">{{ profile.name }}</h5>
                                            {% if profile.description %}
                                                <p class="card-text">{{ profile.description }}</p>
                                            {% endif %}
                                        </div>
                                    </div>
                                {% endfor %}
                            </div>
    
                            <!-- Swiper Arrows -->
                            <div class="swiper-button-prev custom-swiper-btn"></div>
                            <div class="swiper-button-next custom-swiper-btn"></div>
                        </div>
    
                    </div>
    
                    <!-- Error -->
                    <div id="step1-error" class="text-danger mb-2"></div>
    
                    <!-- Next Button -->
                    <div class="d-flex justify-content-end mt-3">
                        <button id="nextBtn" type="submit" class="btn btn-primary">Next ‚û°Ô∏è</button>
                    </div>
                </form>
    
            </div>
        </div>
    </div>
    





  </div>


  <script src="https://cdn.jsdelivr.net/npm/swiper@10/swiper-bundle.min.js"></script>

<script>
    // Initialize Swiper
    const swiper = new Swiper(".mySwiper", {
        slidesPerView: 1,
        spaceBetween: 10,
        navigation: {
            nextEl: ".swiper-button-next",
            prevEl: ".swiper-button-prev",
        },
        loop: false,
    });

    // Card click event ‚Äì select and sync with hidden input
    document.querySelectorAll('.card-choice').forEach(card => {
        card.addEventListener('click', () => {
            document.querySelectorAll('.card-choice').forEach(c => c.classList.remove('selected'));
            card.classList.add('selected');
            document.getElementById('id_appliance_profile').value = card.getAttribute('data-id');
        });
    });

    // Validation logic
    function validateStep1Form() {
        const usageType = document.getElementById("id_usage_type");
        const region = document.getElementById("id_region");
        const applianceProfile = document.getElementById("id_appliance_profile");
        const errorDiv = document.getElementById("step1-error");

        if (!usageType.value || !region.value || !applianceProfile.value) {
            errorDiv.textContent = "Please fill out all fields before proceeding.";
            return false;
        }

        const button = document.getElementById("nextBtn");
        button.disabled = true;
        button.innerHTML = 'Processing... üîÑ';
        return true;
    }
</script>

{% endblock %}

